import Callout from 'nextra-theme-docs/callout'
import Tabs from '../../components/tabs'

# Advanced

The following code examples uses a demo Bucket which includes product data for an ecommerce store. You can run the code examples as is or install the template to your account with the following steps:

1. Create a new project and Bucket after loggin in to your [Cosmic dashboard](https://app.cosmicjs.com).
2. Go to Bucket Settings > Import / Export and install this [Bucket export file](https://cdn.cosmicjs.com/68c19cc0-e04f-11ec-bb19-d9085ce408df-products-bucket.json).
3. In the following examples, switch `YOUR_BUCKET_SLUG` and `YOUR_BUCKET_READ_KEY` to your Bucket access keys. You can find these values located in <i>Your Bucket > Settings > API Access</i> after logging in to your <a href="https://app.cosmicjs.com">Cosmic dashboard</a>.

## Get Products by category

Get Objects from your Cosmic Bucket using the `metadata` query parameter.

<Tabs>
<div label="Node.js">
**Step 1.**
Run the following commands to add the neccessary folder structure and dependencies.
```bash
mkdir cosmic-advanced-example
cd cosmic-advanced-example
yarn add cosmicjs
```
**Step 2.**
Create `index.js` file with the following code.
```javascript
const api = require('cosmicjs')() // empty init
const bucket = api.bucket({
  slug: 'docs-ecommerce-app-production', // YOUR_BUCKET_SLUG
  read_key: '49TG2OEZMVML9fNvVObbFOEsjkFaCYpbVIP1kb8kYCY6RMWqBf' // YOUR_BUCKET_READ_KEY
})
const app = async () => {
  const data = await bucket.getObjects({
    query: {
      type: 'products',
      'metadata.category':'Electronics'
    },
    props: 'slug,title,metadata.category'
  })
  const products = data.objects
  console.log(JSON.stringify(products, null, 2))
}
app()
```
**Step 3.**
Run the app.
```bash
node index.js
```

</div>
<div label="cURL">
```bash
curl https://api.cosmicjs.com/v2/buckets/docs-ecommerce-app-production/objects \
	-d read_key="49TG2OEZMVML9fNvVObbFOEsjkFaCYpbVIP1kb8kYCY6RMWqBf" \
	--data-urlencode query='{"type":"products","metadata.category":"Electronics"}' \
	-d props="slug,title,metadata.category" \
	-G
```
</div>

<div label="GraphQL">
  Add the following query variable.
```json
{
  "query": {
    "type": "products",
    "metadata.category": "Electronics"
  }
}
```
  <a href="https://cosmic-graphql-playground.netlify.app/?endpoint=https%3A%2F%2Fgraphql.cosmicjs.com%2Fv3&query=query%20%28%24query%3A%20JSON%29%0A%7B%0A%20%20getObjects%28%0A%20%20%20%20bucket_slug%3A%20%22docs-ecommerce-app-production%22%0A%20%20%20%20read_key%3A%20%2249TG2OEZMVML9fNvVObbFOEsjkFaCYpbVIP1kb8kYCY6RMWqBf%22%0A%20%20%20%20input%3A%20%7B%0A%20%20%20%20%20%20query%3A%20%24query%0A%20%20%20%20%20%20props%3A%20%22slug%2Ctitle%2Cmetadata%22%0A%20%20%20%20%7D%0A%20%20%29%20%7B%0A%20%20%20%20%20objects%20%7B%0A%20%20%20%20%20%20slug%0A%20%20%20%20%20%20title%0A%20%20%20%20%20%20metadata%0A%20%20%20%20%7D%0A%20%20%20%20total%0A%20%20%7D%0A%7D">
    Full screen
  </a>
  <iframe
    src="https://cosmic-graphql-playground.netlify.app/?endpoint=https%3A%2F%2Fgraphql.cosmicjs.com%2Fv3&query=query%20%28%24query%3A%20JSON%29%0A%7B%0A%20%20getObjects%28%0A%20%20%20%20bucket_slug%3A%20%22docs-ecommerce-app-production%22%0A%20%20%20%20read_key%3A%20%2249TG2OEZMVML9fNvVObbFOEsjkFaCYpbVIP1kb8kYCY6RMWqBf%22%0A%20%20%20%20input%3A%20%7B%0A%20%20%20%20%20%20query%3A%20%24query%0A%20%20%20%20%20%20props%3A%20%22slug%2Ctitle%2Cmetadata%22%0A%20%20%20%20%7D%0A%20%20%29%20%7B%0A%20%20%20%20%20objects%20%7B%0A%20%20%20%20%20%20slug%0A%20%20%20%20%20%20title%0A%20%20%20%20%20%20metadata%0A%20%20%20%20%7D%0A%20%20%20%20total%0A%20%20%7D%0A%7D"
    frameBorder="0"
    style={{ width: '100%', height: '470px' }}
  ></iframe>
</div>

<div label="CLI">
**Step 1.**
Run the following commands to install the Cosmic CLI and connect to your Bucket.
```bash
yarn global add cosmic-cli
cosmic use-bucket docs-ecommerce-app-production --read_key 49TG2OEZMVML9fNvVObbFOEsjkFaCYpbVIP1kb8kYCY6RMWqBf
```
**Step 2.**
Run the following command to get content.
```bash
cosmic get-objects --query '{"type":"products","metadata.category":"Electronics"}' --props "slug,title,metadata.category"
```
</div>
</Tabs>

**Expected Result**

```json
[
  {
    "slug": "watch",
    "title": "Watch",
    "metadata": {
      "category": {
        "key": "electronics",
        "value": "Electronics"
      }
    }
  },
  {
    "slug": "battery-charger",
    "title": "Battery Charger",
    "metadata": {
      "category": {
        "key": "electronics",
        "value": "Electronics"
      }
    }
  },
  {
    "slug": "phone-case",
    "title": "Phone Case",
    "metadata": {
      "category": {
        "key": "electronics",
        "value": "Electronics"
      }
    }
  }
]
```

## Get Products by multiple categories $in

The following example uses the `$in` logic operator to search products by multiple metafield values.

<Tabs>
<div label="Node.js">
**Step 1.**
Run the following commands to add the neccessary folder structure and dependencies.
```bash
mkdir cosmic-advanced-example
cd cosmic-advanced-example
yarn add cosmicjs
```
**Step 2.**
Create `index.js` file with the following code.
```javascript
const api = require('cosmicjs')() // empty init
const bucket = api.bucket({
  slug: 'docs-ecommerce-app-production', // YOUR_BUCKET_SLUG
  read_key: '49TG2OEZMVML9fNvVObbFOEsjkFaCYpbVIP1kb8kYCY6RMWqBf' // YOUR_BUCKET_READ_KEY
})
const app = async () => {
  const data = await bucket.getObjects({
    query: {
      type: 'products',
      'metadata.category': {
        $in: ['Clothing','Food']
      }
    },
    props: 'slug,title,metadata.category',
    limit: 3
  })
  const products = data.objects
  console.log(JSON.stringify(products, null, 2))
}
app()
```
**Step 3.**
Run the app.
```bash
node index.js
```

</div>
<div label="cURL">
```bash
curl https://api.cosmicjs.com/v2/buckets/docs-ecommerce-app-production/objects \
  -d read_key="49TG2OEZMVML9fNvVObbFOEsjkFaCYpbVIP1kb8kYCY6RMWqBf" \
  --data-urlencode query='{"type":"products","metadata.category":{"$in":["Clothing","Food"]}}' \
  -d props="slug,title,metadata.category" \
  -d limit=3 \
  -G
```
</div>

<div label="GraphQL">
  Add the following query variable.
```json
{
  "query": {
    "type": "products",
    "metadata.category": {
      "$in": ["Clothing","Food"]
    }
  }
}
```
  <a href="https://cosmic-graphql-playground.netlify.app/?endpoint=https%3A%2F%2Fgraphql.cosmicjs.com%2Fv3&query=query%20%28%24query%3A%20JSON%29%0A%7B%0A%20%20getObjects%28%0A%20%20%20%20bucket_slug%3A%20%22docs-ecommerce-app-production%22%0A%20%20%20%20read_key%3A%20%2249TG2OEZMVML9fNvVObbFOEsjkFaCYpbVIP1kb8kYCY6RMWqBf%22%0A%20%20%20%20input%3A%20%7B%0A%20%20%20%20%20%20query%3A%20%24query%0A%20%20%20%20%20%20props%3A%20%22slug%2Ctitle%2Cmetadata%22%0A%20%20%20%20%7D%0A%20%20%29%20%7B%0A%20%20%20%20%20objects%20%7B%0A%20%20%20%20%20%20slug%0A%20%20%20%20%20%20title%0A%20%20%20%20%20%20metadata%0A%20%20%20%20%7D%0A%20%20%20%20total%0A%20%20%7D%0A%7D">
    Full screen
  </a>
  <iframe
    src="https://cosmic-graphql-playground.netlify.app/?endpoint=https%3A%2F%2Fgraphql.cosmicjs.com%2Fv3&query=query%20%28%24query%3A%20JSON%29%0A%7B%0A%20%20getObjects%28%0A%20%20%20%20bucket_slug%3A%20%22docs-ecommerce-app-production%22%0A%20%20%20%20read_key%3A%20%2249TG2OEZMVML9fNvVObbFOEsjkFaCYpbVIP1kb8kYCY6RMWqBf%22%0A%20%20%20%20input%3A%20%7B%0A%20%20%20%20%20%20query%3A%20%24query%0A%20%20%20%20%20%20props%3A%20%22slug%2Ctitle%2Cmetadata%22%0A%20%20%20%20%7D%0A%20%20%29%20%7B%0A%20%20%20%20%20objects%20%7B%0A%20%20%20%20%20%20slug%0A%20%20%20%20%20%20title%0A%20%20%20%20%20%20metadata%0A%20%20%20%20%7D%0A%20%20%20%20total%0A%20%20%7D%0A%7D"
    frameBorder="0"
    style={{ width: '100%', height: '470px' }}
  ></iframe>
</div>

<div label="CLI">
**Step 1.**
Run the following commands to install the Cosmic CLI and connect to your Bucket.
```bash
yarn global add cosmic-cli
cosmic use-bucket docs-ecommerce-app-production
```
**Step 2.**
Run the following command to get content.
```bash
cosmic get-objects --query '{"type":"products","metadata.category":{"$in":["Clothing","Food"]}}' --props "slug,title,metadata.category" --limit 3
```
</div>
</Tabs>

**Expected Result**

```json
[
  {
    "slug": "pants",
    "title": "Pants",
    "metadata": {
      "category": {
        "key": "clothing",
        "value": "Clothing"
      }
    }
  },
  {
    "slug": "blouse",
    "title": "Blouse",
    "metadata": {
      "category": {
        "key": "clothing",
        "value": "Clothing"
      }
    }
  },
  {
    "slug": "pineapple",
    "title": "Pineapple",
    "metadata": {
      "category": {
        "key": "food",
        "value": "Food"
      }
    }
  }
]
```

## Get Products by price $lte

The following example uses the `$lte` logic operator to search products by price.

<Tabs>
<div label="Node.js">
**Step 1.**
Run the following commands to add the neccessary folder structure and dependencies.
```bash
mkdir cosmic-advanced-example
cd cosmic-advanced-example
yarn add cosmicjs
```
**Step 2.**
Create `index.js` file with the following code.
```javascript
const api = require('cosmicjs')() // empty init
const bucket = api.bucket({
  slug: 'docs-ecommerce-app-production', // YOUR_BUCKET_SLUG
  read_key: '49TG2OEZMVML9fNvVObbFOEsjkFaCYpbVIP1kb8kYCY6RMWqBf' // YOUR_BUCKET_READ_KEY
})
const app = async () => {
  const data = await bucket.getObjects({
    query: {
      type: 'products',
      'metadata.price': {
        $lte: 10.00
      }
    },
    props: 'slug,title,metadata.price'
  })
  const products = data.objects
  console.log(JSON.stringify(products, null, 2))
}
app()
```
**Step 3.**
Run the app.
```bash
node index.js
```

</div>
<div label="cURL">
```bash
curl https://api.cosmicjs.com/v2/buckets/docs-ecommerce-app-production/objects \
	-d read_key="49TG2OEZMVML9fNvVObbFOEsjkFaCYpbVIP1kb8kYCY6RMWqBf" \
	--data-urlencode query='{"type":"products","metadata.price":{"$lte":10.00}}' \
	-d props="slug,title,metadata.price" \
	-G
```
</div>

<div label="GraphQL">
  Add the following query variable.
```json
{
  "query": {
    "type": "products",
    "metadata.price": {
      "$lte": 10.00
    }
  }
}
```
  <a href="https://cosmic-graphql-playground.netlify.app/?endpoint=https%3A%2F%2Fgraphql.cosmicjs.com%2Fv3&query=query%20%28%24query%3A%20JSON%29%0A%7B%0A%20%20getObjects%28%0A%20%20%20%20bucket_slug%3A%20%22docs-ecommerce-app-production%22%0A%20%20%20%20read_key%3A%20%2249TG2OEZMVML9fNvVObbFOEsjkFaCYpbVIP1kb8kYCY6RMWqBf%22%0A%20%20%20%20input%3A%20%7B%0A%20%20%20%20%20%20query%3A%20%24query%0A%20%20%20%20%20%20props%3A%20%22slug%2Ctitle%2Cmetadata%22%0A%20%20%20%20%7D%0A%20%20%29%20%7B%0A%20%20%20%20%20objects%20%7B%0A%20%20%20%20%20%20slug%0A%20%20%20%20%20%20title%0A%20%20%20%20%20%20metadata%0A%20%20%20%20%7D%0A%20%20%20%20total%0A%20%20%7D%0A%7D">
    Full screen
  </a>
  <iframe
    src="https://cosmic-graphql-playground.netlify.app/?endpoint=https%3A%2F%2Fgraphql.cosmicjs.com%2Fv3&query=query%20%28%24query%3A%20JSON%29%0A%7B%0A%20%20getObjects%28%0A%20%20%20%20bucket_slug%3A%20%22docs-ecommerce-app-production%22%0A%20%20%20%20read_key%3A%20%2249TG2OEZMVML9fNvVObbFOEsjkFaCYpbVIP1kb8kYCY6RMWqBf%22%0A%20%20%20%20input%3A%20%7B%0A%20%20%20%20%20%20query%3A%20%24query%0A%20%20%20%20%20%20props%3A%20%22slug%2Ctitle%2Cmetadata%22%0A%20%20%20%20%7D%0A%20%20%29%20%7B%0A%20%20%20%20%20objects%20%7B%0A%20%20%20%20%20%20slug%0A%20%20%20%20%20%20title%0A%20%20%20%20%20%20metadata%0A%20%20%20%20%7D%0A%20%20%20%20total%0A%20%20%7D%0A%7D"
    frameBorder="0"
    style={{ width: '100%', height: '470px' }}
  ></iframe>
</div>

<div label="CLI">
**Step 1.**
Run the following commands to install the Cosmic CLI and connect to your Bucket.
```bash
yarn global add cosmic-cli
cosmic use-bucket docs-ecommerce-app-production
```
**Step 2.**
Run the following command to get content.
```bash
cosmic get-objects --query '{"type":"products","metadata.price":{"$lte":10.00}}' --props "slug,title,metadata.price"
```
</div>
</Tabs>

**Expected Result**

```json
[
  {
    "slug": "pineapple",
    "title": "Pineapple",
    "metadata": {
      "price": 1.99
    }
  },
  {
    "slug": "sandwich",
    "title": "Sandwich",
    "metadata": {
      "price": 8.99
    }
  }
]
```

## Next steps

<Callout emoji="💡">
  **Learn More**
  <br />
  Go to the [queries section](/api-reference/queries) in the docs to learn more
  about Cosmic queries and available methods.
</Callout>
